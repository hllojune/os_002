<svg viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="700" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
    input1.spl 실행 과정: 스택(Stack) 변화 시각화
  </text>
  
  <!-- Step 1: main 함수 변수 선언 -->
  <g id="step1">
    <text x="70" y="80" font-size="16" font-weight="bold" fill="#2563eb">Step 1: main 함수 진입 및 변수 선언</text>
    <rect x="50" y="100" width="200" height="250" fill="#f0f9ff" stroke="#2563eb" stroke-width="2" rx="5"/>
    
    <!-- Stack frames -->
    <rect x="70" y="120" width="160" height="60" fill="#dbeafe" stroke="#1e40af" stroke-width="1.5"/>
    <text x="150" y="145" font-size="14" text-anchor="middle" font-family="monospace">c = 4 (type:1)</text>
    <text x="150" y="165" font-size="12" text-anchor="middle" fill="#666">main 지역변수</text>
    
    <rect x="70" y="190" width="160" height="60" fill="#dbeafe" stroke="#1e40af" stroke-width="1.5"/>
    <text x="150" y="215" font-size="14" text-anchor="middle" font-family="monospace">b = 2 (type:1)</text>
    <text x="150" y="235" font-size="12" text-anchor="middle" fill="#666">main 지역변수</text>
    
    <rect x="70" y="260" width="160" height="60" fill="#dbeafe" stroke="#1e40af" stroke-width="1.5"/>
    <text x="150" y="285" font-size="14" text-anchor="middle" font-family="monospace">a = 1 (type:1)</text>
    <text x="150" y="305" font-size="12" text-anchor="middle" fill="#666">main 지역변수</text>
    
    <text x="150" y="340" font-size="11" text-anchor="middle" fill="#666" font-style="italic">← Stack TOP</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 270 225 L 330 225" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 2: f(c) 함수 호출 -->
  <g id="step2">
    <text x="350" y="80" font-size="16" font-weight="bold" fill="#dc2626">Step 2: f(c) 함수 호출</text>
    <rect x="330" y="100" width="200" height="320" fill="#fef2f2" stroke="#dc2626" stroke-width="2" rx="5"/>
    
    <!-- Function call marker -->
    <rect x="350" y="120" width="160" height="50" fill="#fecaca" stroke="#991b1b" stroke-width="2"/>
    <text x="430" y="140" font-size="13" text-anchor="middle" font-family="monospace" font-weight="bold">Call: line 13</text>
    <text x="430" y="160" font-size="12" text-anchor="middle" fill="#666">(type:3)</text>
    
    <!-- Previous variables (lighter) -->
    <rect x="350" y="180" width="160" height="50" fill="#e0e7ff" stroke="#6366f1" stroke-width="1" opacity="0.6"/>
    <text x="430" y="205" font-size="12" text-anchor="middle" font-family="monospace">c = 4</text>
    
    <rect x="350" y="240" width="160" height="50" fill="#e0e7ff" stroke="#6366f1" stroke-width="1" opacity="0.6"/>
    <text x="430" y="265" font-size="12" text-anchor="middle" font-family="monospace">b = 2</text>
    
    <rect x="350" y="300" width="160" height="50" fill="#e0e7ff" stroke="#6366f1" stroke-width="1" opacity="0.6"/>
    <text x="430" y="325" font-size="12" text-anchor="middle" font-family="monospace">a = 1</text>
    
    <text x="430" y="375" font-size="11" text-anchor="middle" fill="#666" font-style="italic">CalingFunctionArgVal = 4</text>
    <text x="430" y="395" font-size="11" text-anchor="middle" fill="#dc2626" font-weight="bold">→ 파일 포인터를 f 정의(line 1)로 이동</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 550 225 L 610 225" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 3: f 함수 내부 실행 -->
  <g id="step3">
    <text x="630" y="80" font-size="16" font-weight="bold" fill="#16a34a">Step 3: f 함수 내부 실행</text>
    <rect x="610" y="100" width="200" height="390" fill="#f0fdf4" stroke="#16a34a" stroke-width="2" rx="5"/>
    
    <!-- f function variables -->
    <rect x="630" y="120" width="160" height="50" fill="#bbf7d0" stroke="#15803d" stroke-width="1.5"/>
    <text x="710" y="140" font-size="14" text-anchor="middle" font-family="monospace">c = 2 (type:1)</text>
    <text x="710" y="158" font-size="11" text-anchor="middle" fill="#666">f 지역변수</text>
    
    <rect x="630" y="180" width="160" height="50" fill="#bbf7d0" stroke="#15803d" stroke-width="1.5"/>
    <text x="710" y="200" font-size="14" text-anchor="middle" font-family="monospace">b = 6 (type:1)</text>
    <text x="710" y="218" font-size="11" text-anchor="middle" fill="#666">f 지역변수</text>
    
    <rect x="630" y="240" width="160" height="50" fill="#bbf7d0" stroke="#15803d" stroke-width="1.5"/>
    <text x="710" y="260" font-size="14" text-anchor="middle" font-family="monospace">a = 4 (type:1)</text>
    <text x="710" y="278" font-size="11" text-anchor="middle" fill="#666">f 매개변수</text>
    
    <line x1="630" y1="300" x2="790" y2="300" stroke="#666" stroke-width="1" stroke-dasharray="2,2"/>
    
    <!-- Call marker and main vars (lighter) -->
    <rect x="630" y="310" width="160" height="40" fill="#fecaca" stroke="#991b1b" stroke-width="1" opacity="0.5"/>
    <text x="710" y="333" font-size="11" text-anchor="middle" font-family="monospace">Call: line 13</text>
    
    <text x="710" y="365" font-size="12" text-anchor="middle" fill="#666" opacity="0.6">main 변수들 (c, b, a)</text>
    
    <text x="710" y="395" font-size="11" text-anchor="middle" fill="#666" font-style="italic">← Stack TOP</text>
    
    <!-- Calculation box -->
    <rect x="625" y="420" width="170" height="60" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="3"/>
    <text x="710" y="440" font-size="13" text-anchor="middle" font-weight="bold">수식 계산:</text>
    <text x="710" y="460" font-size="12" text-anchor="middle" font-family="monospace">((6+2)/4) = 2</text>
    <text x="710" y="475" font-size="11" text-anchor="middle" fill="#666">LastExpReturn = 2</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 830 225 L 890 225" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 4: f 함수 종료 및 복귀 -->
  <g id="step4">
    <text x="910" y="80" font-size="16" font-weight="bold" fill="#9333ea">Step 4: f 함수 종료 (end)</text>
    <rect x="890" y="100" width="200" height="320" fill="#faf5ff" stroke="#9333ea" stroke-width="2" rx="5"/>
    
    <!-- Main variables restored -->
    <rect x="910" y="120" width="160" height="50" fill="#ddd6fe" stroke="#6b21a8" stroke-width="1.5"/>
    <text x="990" y="140" font-size="14" text-anchor="middle" font-family="monospace">c = 4 (type:1)</text>
    <text x="990" y="158" font-size="11" text-anchor="middle" fill="#666">main 지역변수</text>
    
    <rect x="910" y="180" width="160" height="50" fill="#ddd6fe" stroke="#6b21a8" stroke-width="1.5"/>
    <text x="990" y="200" font-size="14" text-anchor="middle" font-family="monospace">b = 2 (type:1)</text>
    <text x="990" y="218" font-size="11" text-anchor="middle" fill="#666">main 지역변수</text>
    
    <rect x="910" y="240" width="160" height="50" fill="#ddd6fe" stroke="#6b21a8" stroke-width="1.5"/>
    <text x="990" y="260" font-size="14" text-anchor="middle" font-family="monospace">a = 1 (type:1)</text>
    <text x="990" y="278" font-size="11" text-anchor="middle" fill="#666">main 지역변수</text>
    
    <text x="990" y="310" font-size="11" text-anchor="middle" fill="#666" font-style="italic">← Stack TOP</text>
    
    <!-- Return value box -->
    <rect x="905" y="330" width="170" height="80" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="3"/>
    <text x="990" y="350" font-size="13" text-anchor="middle" font-weight="bold">함수 반환:</text>
    <text x="990" y="370" font-size="12" text-anchor="middle">LastFunctionReturn = 2</text>
    <text x="990" y="388" font-size="11" text-anchor="middle" fill="#666">f 함수 변수 pop 완료</text>
    <text x="990" y="403" font-size="11" text-anchor="middle" fill="#9333ea" font-weight="bold">→ line 13으로 복귀</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 1110 225 L 1170 225" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 5: main 함수 최종 계산 -->
  <g id="step5">
    <text x="1190" y="80" font-size="16" font-weight="bold" fill="#ea580c">Step 5: main 최종 계산</text>
    <rect x="1170" y="100" width="200" height="320" fill="#fff7ed" stroke="#ea580c" stroke-width="2" rx="5"/>
    
    <!-- Main variables -->
    <rect x="1190" y="120" width="160" height="50" fill="#fed7aa" stroke="#c2410c" stroke-width="1.5"/>
    <text x="1270" y="140" font-size="14" text-anchor="middle" font-family="monospace">c = 4</text>
    
    <rect x="1190" y="180" width="160" height="50" fill="#fed7aa" stroke="#c2410c" stroke-width="1.5"/>
    <text x="1270" y="200" font-size="14" text-anchor="middle" font-family="monospace">b = 2</text>
    
    <rect x="1190" y="240" width="160" height="50" fill="#fed7aa" stroke="#c2410c" stroke-width="1.5"/>
    <text x="1270" y="260" font-size="14" text-anchor="middle" font-family="monospace">a = 1</text>
    
    <!-- Final calculation -->
    <rect x="1185" y="310" width="170" height="100" fill="#dcfce7" stroke="#16a34a" stroke-width="2" rx="3"/>
    <text x="1270" y="330" font-size="13" text-anchor="middle" font-weight="bold">최종 수식 계산:</text>
    <text x="1270" y="350" font-size="12" text-anchor="middle" font-family="monospace">((6 + f(c)) / b)</text>
    <text x="1270" y="370" font-size="12" text-anchor="middle" font-family="monospace">= ((6 + 2) / 2)</text>
    <text x="1270" y="390" font-size="14" text-anchor="middle" font-family="monospace" font-weight="bold">= 4</text>
    <text x="1270" y="405" font-size="11" text-anchor="middle" fill="#666">LastExpReturn = 4</text>
  </g>
  
  <!-- Bottom: Output -->
  <g id="output">
    <rect x="400" y="520" width="600" height="100" fill="#1e293b" stroke="#0ea5e9" stroke-width="3" rx="8"/>
    <text x="700" y="555" font-size="20" font-weight="bold" text-anchor="middle" fill="#0ea5e9">main 함수 end 도달</text>
    <text x="700" y="590" font-size="28" font-weight="bold" text-anchor="middle" fill="#22c55e" font-family="monospace">Output = 4</text>
  </g>
  
  <!-- Legend -->
  <g id="legend">
    <text x="100" y="660" font-size="16" font-weight="bold" fill="#333">범례 (Legend)</text>
    
    <rect x="100" y="680" width="30" height="25" fill="#dbeafe" stroke="#1e40af" stroke-width="1.5"/>
    <text x="140" y="697" font-size="13" fill="#333">변수 (type:1)</text>
    
    <rect x="280" y="680" width="30" height="25" fill="#fecaca" stroke="#991b1b" stroke-width="1.5"/>
    <text x="320" y="697" font-size="13" fill="#333">함수 호출 마커 (type:3)</text>
    
    <rect x="500" y="680" width="30" height="25" fill="#bbf7d0" stroke="#15803d" stroke-width="1.5"/>
    <text x="540" y="697" font-size="13" fill="#333">호출된 함수의 지역변수</text>
    
    <rect x="750" y="680" width="30" height="25" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="790" y="697" font-size="13" fill="#333">수식 계산 결과</text>
  </g>
  
  <!-- Key Concepts -->
  <g id="concepts">
    <text x="100" y="750" font-size="16" font-weight="bold" fill="#333">핵심 개념</text>
    
    <text x="100" y="780" font-size="13" fill="#333">
      • <tspan font-weight="bold">Stack 구조:</tspan> LIFO(Last In First Out) - 가장 나중에 push된 변수가 먼저 조회됨
    </text>
    <text x="100" y="805" font-size="13" fill="#333">
      • <tspan font-weight="bold">함수 호출:</tspan> type 3 마커를 push하여 복귀 위치(line 번호)를 저장
    </text>
    <text x="100" y="830" font-size="13" fill="#333">
      • <tspan font-weight="bold">변수 Scope:</tspan> GetVal()은 스택 top부터 검색하므로 가장 최근 선언된 변수를 찾음
    </text>
    <text x="100" y="855" font-size="13" fill="#333">
      • <tspan font-weight="bold">함수 종료:</tspan> end를 만나면 LastFunctionReturn에 결과를 저장하고, 함수의 모든 변수를 pop
    </text>
    <text x="100" y="880" font-size="13" fill="#333">
      • <tspan font-weight="bold">파일 포인터 제어:</tspan> 함수 호출 시 fclose/fopen으로 파일을 되감아 함수 정의 위치로 이동
    </text>
  </g>
  
  <!-- Stack growth direction indicator -->
  <g id="direction">
    <path d="M 30 150 L 30 300" stroke="#666" stroke-width="2" marker-end="url(#arrowhead2)"/>
    <text x="15" y="220" font-size="12" fill="#666" transform="rotate(-90 15 220)">Stack 확장 방향</text>
  </g>
  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666"/>
    </marker>
    <marker id="arrowhead2" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <polygon points="0 0, 12 0, 6 12" fill="#666" transform="rotate(270, 6, 6)"/>
    </marker>
  </defs>
</svg>